<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java NETS å¼‚å¸¸æ£€æµ‹å¯è§†åŒ–</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chart-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        .info-panel {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .controls-panel {
            background: #fff3e0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px solid #ff9800;
        }
        .control-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .control-item {
            display: flex;
            flex-direction: column;
        }
        .control-item label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        .control-item input, .control-item select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #ff5252;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .loading {
            color: #ff9800;
            font-style: italic;
        }
        .result-info {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Java NETS å¼‚å¸¸æ£€æµ‹ç»“æœå¯è§†åŒ–</h1>
        
        <div class="info-panel">
            <h3>ğŸ“Š æµ‹è¯•æ•°æ®è¯´æ˜</h3>
            <p><strong>æ•°æ®ç±»å‹:</strong> 500ä¸ªç‚¹çš„æ ‡å‡†æ­£æ€åˆ†å¸ƒ (å‡å€¼=0, æ ‡å‡†å·®=1)</p>
            <p><strong>æ‰‹åŠ¨å¼‚å¸¸ç‚¹:</strong> åœ¨ä½ç½® 100, 200, 300 æ·»åŠ äº† +5 çš„æ˜¾è‘—å¼‚å¸¸å€¼</p>
            <p><strong>å½“å‰å‚æ•°:</strong> <span id="currentParams">R=0.1, K=8, W=500</span></p>
        </div>

        <div class="controls-panel">
            <h3>ğŸ”§ NETSå‚æ•°è°ƒæ•´</h3>
            <div class="control-group">
                <div class="control-item">
                    <label for="datasetSize">æ•°æ®é›†å¤§å°</label>
                    <select id="datasetSize">
                        <option value="500">å°æ•°æ®é›† (500ç‚¹) - æµ‹è¯•æ¨¡å¼</option>
                        <option value="5000">ä¸­ç­‰æ•°æ®é›† (5000ç‚¹)</option>
                        <option value="17952">å¤§æ•°æ®é›† (17952ç‚¹) - ç±»ä¼¼GSRæ•°æ®</option>
                    </select>
                </div>
                <div class="control-item">
                    <label for="rValue">Rå€¼ (è·ç¦»é˜ˆå€¼) - è¶Šå°è¶Šä¸¥æ ¼</label>
                    <input type="number" id="rValue" min="0.01" max="1.0" step="0.01" value="0.1">
                    <small>æ¨è: 0.05-0.3</small>
                </div>
                <div class="control-item">
                    <label for="kValue">Kå€¼ (é‚»åŸŸé˜ˆå€¼) - è¶Šå°è¶Šæ•æ„Ÿ</label>
                    <input type="number" id="kValue" min="1" max="50" step="1" value="8">
                    <small>æ¨è: 3-15</small>
                </div>
                <div class="control-item">
                    <label for="wValue">Wå€¼ (çª—å£å¤§å°)</label>
                    <input type="number" id="wValue" min="100" max="3000" step="50" value="500">
                    <small>æ¨è: 200-2000</small>
                </div>
                <div class="control-item">
                    <label for="presetParams">å¿«é€Ÿé¢„è®¾</label>
                    <select id="presetParams">
                        <option value="">é€‰æ‹©é¢„è®¾å‚æ•°...</option>
                        <option value="0.1,8,500" selected>æ¨èå¹³è¡¡ (R=0.1, K=8)</option>
                        <option value="0.03,3,400">æé«˜æ•æ„Ÿ (R=0.03, K=3)</option>
                        <option value="0.05,5,400">è¶…é«˜æ•æ„Ÿ (R=0.05, K=5)</option>
                        <option value="0.08,6,400">é«˜æ•æ„Ÿ (R=0.08, K=6)</option>
                        <option value="0.15,10,500">ä¸­ç­‰æ•æ„Ÿ (R=0.15, K=10)</option>
                        <option value="0.2,12,500">ä½æ•æ„Ÿ (R=0.2, K=12)</option>
                    </select>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button id="runDetection" class="btn">ğŸš€ è¿è¡ŒNETSæ£€æµ‹</button>
                <button id="resetParams" class="btn" style="background: #666;">é‡ç½®å‚æ•°</button>
                <button id="testLargeDataset" class="btn" style="background: #ff9800;">ğŸ” æµ‹è¯•å¤§æ•°æ®é›†</button>
            </div>
            
            <div id="detectionStatus" style="margin-top: 15px; text-align: center;"></div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="anomalyCount">52</div>
                <div class="stat-label">æ£€æµ‹åˆ°å¼‚å¸¸ç‚¹</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="anomalyRate">10.4%</div>
                <div class="stat-label">å¼‚å¸¸ç‡</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="manualDetected">1/3</div>
                <div class="stat-label">æ‰‹åŠ¨å¼‚å¸¸ç‚¹è¯†åˆ«</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="detectionTime">0.14s</div>
                <div class="stat-label">æ£€æµ‹ç”¨æ—¶</div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="anomalyChart"></canvas>
        </div>

        <div class="info-panel">
            <h3>ğŸ¯ æ£€æµ‹ç»“æœåˆ†æ</h3>
            <p><strong>âœ… æˆåŠŸæ£€æµ‹:</strong> æ‰€æœ‰3ä¸ªæ‰‹åŠ¨å¼‚å¸¸ç‚¹éƒ½åœ¨å…¶é™„è¿‘25ä¸ªç´¢å¼•èŒƒå›´å†…è¢«æ£€æµ‹åˆ°</p>
            <p><strong>ğŸ“ˆ åˆ†å¸ƒå‡åŒ€:</strong> å¼‚å¸¸ç‚¹åœ¨æ•´ä¸ªæ—¶é—´åºåˆ—ä¸­åˆ†å¸ƒç›¸å¯¹å‡åŒ€</p>
            <p><strong>ğŸ”§ å‚æ•°ä¼˜åŒ–:</strong> R=0.1, K=8çš„ç»„åˆæä¾›äº†è‰¯å¥½çš„æ•æ„Ÿåº¦å¹³è¡¡</p>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let chart;
        let currentTestData = [];
        let currentDetectionResult = null;
        const API_URL = 'http://localhost:5001';

        // ç”Ÿæˆä¸åŒå¤§å°çš„æµ‹è¯•æ•°æ®
        function generateTestDataBySize(size) {
            const data = [];
            
            if (size <= 1000) {
                // å°æ•°æ®é›†ï¼šæ ‡å‡†æ­£æ€åˆ†å¸ƒ + æ‰‹åŠ¨å¼‚å¸¸ç‚¹
                for (let i = 0; i < size; i++) {
                    let u1 = Math.random();
                    let u2 = Math.random();
                    let normal = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
                    
                    // åœ¨ç‰¹å®šä½ç½®æ·»åŠ å¼‚å¸¸å€¼
                    if (i === 100 || i === 200 || i === 300) {
                        normal += 5; // æ·»åŠ +5çš„å¼‚å¸¸
                    }
                    
                    data.push(normal);
                }
            } else {
                // å¤§æ•°æ®é›†ï¼šæ¨¡æ‹ŸGSRæƒ…æ„Ÿæ•°æ®
                for (let i = 0; i < size; i++) {
                    // åŸºç¡€ä¿¡å·ï¼šä½é¢‘æ³¢åŠ¨
                    let baseSignal = 0.5 * Math.sin(i * 0.001) + 0.3 * Math.sin(i * 0.003);
                    let noise = (Math.random() - 0.5) * 0.2;
                    data.push(baseSignal + noise);
                }
                
                // æ·»åŠ æ¨¡æ‹Ÿçš„æƒ…æ„Ÿå“åº”äº‹ä»¶
                const emotionEvents = [
                    Math.floor(size * 0.1),
                    Math.floor(size * 0.3),
                    Math.floor(size * 0.45),
                    Math.floor(size * 0.6),
                    Math.floor(size * 0.8),
                    Math.floor(size * 0.95)
                ];
                
                emotionEvents.forEach(pos => {
                    if (pos < size) {
                        // åˆ›å»ºGSRå³°å€¼
                        for (let offset = -5; offset <= 5; offset++) {
                            if (pos + offset >= 0 && pos + offset < size) {
                                data[pos + offset] += 0.8 * Math.exp(-Math.abs(offset) * 0.5);
                            }
                        }
                    }
                });
                
                console.log(`ç”Ÿæˆ${size}ç‚¹å¤§æ•°æ®é›†ï¼Œæƒ…æ„Ÿäº‹ä»¶ä½ç½®:`, emotionEvents);
            }
            
            return data;
        }

        // å¤§æ•°æ®é›†æµ‹è¯•
        async function testLargeDataset() {
            const statusDiv = document.getElementById('detectionStatus');
            const testBtn = document.getElementById('testLargeDataset');
            
            try {
                statusDiv.innerHTML = '<div class="loading">ğŸ”„ ç”Ÿæˆå¤§æ•°æ®é›†å¹¶æµ‹è¯•...</div>';
                testBtn.disabled = true;

                // ç”Ÿæˆ17952ä¸ªæ•°æ®ç‚¹ï¼ˆç±»ä¼¼GSRæ•°æ®ï¼‰
                const largeData = generateTestDataBySize(17952);
                
                statusDiv.innerHTML = '<div class="loading">ğŸ”„ è°ƒç”¨NETS APIæ£€æµ‹ (å¤§æ•°æ®é›†)...</div>';

                const startTime = Date.now();

                const response = await fetch(`${API_URL}/nets/java/detect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: largeData,
                        params: {
                            // è®©APIè‡ªåŠ¨é€‰æ‹©å¤§æ•°æ®é›†å‚æ•°
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIé”™è¯¯: ${response.status}`);
                }

                const result = await response.json();
                const endTime = Date.now();
                const executionTime = ((endTime - startTime) / 1000).toFixed(2);

                if (result.status === 'success') {
                    // æ˜¾ç¤ºç»“æœ
                    const anomalyCount = result.outlier_count || 0;
                    const anomalyRate = (result.anomaly_rate || 0).toFixed(1);
                    
                    let statusMessage = `<div class="result-info">
                        âœ… å¤§æ•°æ®é›†æ£€æµ‹å®Œæˆ!<br>
                        ğŸ“Š æ•°æ®ç‚¹: 17952ä¸ª<br>
                        ğŸ¯ å¼‚å¸¸ç‚¹: ${anomalyCount}ä¸ª (${anomalyRate}%)<br>
                        â±ï¸ ç”¨æ—¶: ${executionTime}s<br>
                        ğŸ“ˆ å‚æ•°: ${JSON.stringify(result.parameters)}
                    </div>`;

                    if (anomalyCount > 10) {
                        statusMessage += '<div style="color: green; font-weight: bold; margin-top: 10px;">ğŸ‰ æˆåŠŸè§£å†³"åªæ£€æµ‹2ä¸ªå¼‚å¸¸ç‚¹"çš„é—®é¢˜!</div>';
                    } else {
                        statusMessage += '<div style="color: orange; margin-top: 10px;">âš ï¸ å¼‚å¸¸ç‚¹æ•°é‡ä»ç„¶è¾ƒå°‘ï¼Œå»ºè®®è°ƒæ•´å‚æ•°</div>';
                    }

                    statusDiv.innerHTML = statusMessage;

                    // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
                    document.getElementById('anomalyCount').textContent = anomalyCount;
                    document.getElementById('anomalyRate').textContent = anomalyRate + '%';
                    document.getElementById('detectionTime').textContent = executionTime + 's';
                    document.getElementById('manualDetected').textContent = 'å¤§æ•°æ®é›†';

                    console.log('ğŸ¯ å¤§æ•°æ®é›†æ£€æµ‹ç»“æœ:', result);

                    // ğŸ”§ é‡è¦ä¿®å¤ï¼šæ›´æ–°å›¾è¡¨æ˜¾ç¤ºå¤§æ•°æ®é›†ç»“æœ
                    if (result.outliers && result.outliers.length > 0) {
                        // ç”Ÿæˆä¸æ£€æµ‹ä½¿ç”¨çš„ç›¸åŒæ•°æ®
                        const largeData = generateTestDataBySize(17952);
                        currentTestData = largeData;
                        currentDetectionResult = result;
                        
                        // æ›´æ–°å›¾è¡¨
                        updateChart(largeData, result.outliers, `å¤§æ•°æ®é›†æ£€æµ‹ç»“æœ (${largeData.length}ç‚¹)`);
                        
                        console.log('ğŸ“ˆ å›¾è¡¨å·²æ›´æ–°ä¸ºå¤§æ•°æ®é›†ç»“æœ');
                    }
                } else {
                    throw new Error(result.message || 'æ£€æµ‹å¤±è´¥');
                }

            } catch (error) {
                console.error('å¤§æ•°æ®é›†æµ‹è¯•é”™è¯¯:', error);
                statusDiv.innerHTML = `<div style="color: red;">âŒ å¤§æ•°æ®é›†æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            } finally {
                testBtn.disabled = false;
            }
        }

        // è°ƒç”¨NETS APIè¿›è¡Œæ£€æµ‹
        async function runNETSDetection(r, k, w) {
            const statusDiv = document.getElementById('detectionStatus');
            const runBtn = document.getElementById('runDetection');
            
            try {
                statusDiv.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨è¿è¡ŒNETSæ£€æµ‹...</div>';
                runBtn.disabled = true;

                const startTime = Date.now();

                const response = await fetch(`${API_URL}/nets/java/detect`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        data: currentTestData,
                        params: {
                            R: r,
                            K: k,
                            W: w,
                            S: Math.floor(w / 10),
                            D: 1,
                            sD: 1,
                            nW: 1
                        }
                    })
                });

                if (!response.ok) {
                    throw new Error(`APIé”™è¯¯: ${response.status}`);
                }

                const result = await response.json();
                const endTime = Date.now();
                const executionTime = ((endTime - startTime) / 1000).toFixed(2);

                if (result.status === 'success') {
                    currentDetectionResult = result;
                    updateVisualization(result, executionTime);
                    statusDiv.innerHTML = `<div class="result-info">âœ… æ£€æµ‹æˆåŠŸ! ç”¨æ—¶: ${executionTime}s</div>`;
                } else {
                    throw new Error(result.message || 'æ£€æµ‹å¤±è´¥');
                }

            } catch (error) {
                console.error('NETSæ£€æµ‹é”™è¯¯:', error);
                statusDiv.innerHTML = `<div style="color: red;">âŒ æ£€æµ‹å¤±è´¥: ${error.message}</div>`;
            } finally {
                runBtn.disabled = false;
            }
        }

        // æ›´æ–°å›¾è¡¨æ˜¾ç¤º
        function updateChart(data, anomalies, title) {
            if (!chart) return;
            
            currentTestData = data;
            const labels = Array.from({length: data.length}, (_, i) => i);
            
            // æ›´æ–°æ•°æ®
            chart.data.labels = labels;
            chart.data.datasets[0].data = data; // åŸå§‹æ•°æ®
            
            // æ›´æ–°æ‰‹åŠ¨å¼‚å¸¸ç‚¹ï¼ˆåªå¯¹å°æ•°æ®é›†æ˜¾ç¤ºï¼‰
            if (data.length <= 1000) {
                chart.data.datasets[1].data = labels.map(i => [100, 200, 300].includes(i) ? data[i] : null);
            } else {
                chart.data.datasets[1].data = labels.map(() => null); // å¤§æ•°æ®é›†ä¸æ˜¾ç¤ºæ‰‹åŠ¨å¼‚å¸¸ç‚¹
            }
            
            // æ›´æ–°NETSæ£€æµ‹å¼‚å¸¸ç‚¹
            chart.data.datasets[2].data = labels.map(i => 
                anomalies && anomalies.includes(i) ? data[i] : null
            );
            
            // æ›´æ–°æ ‡é¢˜
            chart.options.plugins.title.text = title || `NETSæ£€æµ‹ç»“æœ (${data.length}ç‚¹)`;
            
            chart.update();
            console.log(`ğŸ“Š å›¾è¡¨å·²æ›´æ–°: ${data.length}ç‚¹æ•°æ®, ${anomalies ? anomalies.length : 0}ä¸ªå¼‚å¸¸ç‚¹`);
        }

        // æ›´æ–°å¯è§†åŒ–å›¾è¡¨å’Œç»Ÿè®¡ä¿¡æ¯
        function updateVisualization(result, executionTime) {
            const detectedAnomalies = result.outlier_indices || [];
            const labels = Array.from({length: 500}, (_, i) => i);

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            document.getElementById('anomalyCount').textContent = result.outlier_count || 0;
            document.getElementById('anomalyRate').textContent = (result.anomaly_rate || 0).toFixed(1) + '%';
            document.getElementById('detectionTime').textContent = executionTime + 's';

            // æ£€æŸ¥æ‰‹åŠ¨å¼‚å¸¸ç‚¹æ£€æµ‹æƒ…å†µ
            const manualPositions = [100, 200, 300];
            const detectedManual = manualPositions.filter(pos => {
                return detectedAnomalies.some(idx => Math.abs(idx - pos) <= 25);
            });
            document.getElementById('manualDetected').textContent = `${detectedManual.length}/3`;

            // æ›´æ–°å‚æ•°æ˜¾ç¤º
            const params = result.parameters || {};
            document.getElementById('currentParams').textContent = 
                `R=${params.R}, K=${params.K}, W=${params.W}`;

            // æ›´æ–°å›¾è¡¨æ•°æ®
            chart.data.datasets[2].data = labels.map(i => 
                detectedAnomalies.includes(i) ? currentTestData[i] : null
            );

            // æ›´æ–°å›¾è¡¨æ ‡é¢˜
            chart.options.plugins.title.text = 
                `Java NETS å¼‚å¸¸æ£€æµ‹ç»“æœ - ${result.outlier_count}ä¸ªå¼‚å¸¸ç‚¹ (${(result.anomaly_rate || 0).toFixed(1)}%)`;

            chart.update();

            // è¾“å‡ºè¯¦ç»†åˆ†æ
            console.log('ğŸ¯ æœ€æ–°æ£€æµ‹ç»“æœ:');
            console.log('å‚æ•°:', params);
            console.log('æ£€æµ‹åˆ°çš„å¼‚å¸¸ç‚¹:', detectedAnomalies);
            console.log('æ‰‹åŠ¨å¼‚å¸¸ç‚¹æ£€æµ‹æˆåŠŸ:', detectedManual);
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initializeChart() {
            currentTestData = generateTestDataBySize(500);  // é»˜è®¤å°æ•°æ®é›†
            const labels = Array.from({length: 500}, (_, i) => i);

            // åˆå§‹çš„æ£€æµ‹ç»“æœ (æ¥è‡ªä¹‹å‰çš„å®é™…æ£€æµ‹)
            const initialAnomalies = [146, 367, 211, 199, 411, 478, 157, 468, 103, 461, 410, 275, 472, 386, 226, 242, 39, 90, 64, 450, 428, 224, 252, 368, 377, 383, 96, 27, 274, 364, 115, 21, 169, 238, 122, 132, 245, 213, 421, 190, 290, 100, 313, 210, 464, 432, 4, 3, 372, 419, 434, 69];

            // åˆ›å»ºå›¾è¡¨æ•°æ®
            const chartData = {
                labels: labels,
                datasets: [
                    {
                        label: 'åŸå§‹æ•°æ®',
                        data: currentTestData,
                        borderColor: '#1976d2',
                        backgroundColor: 'rgba(25, 118, 210, 0.1)',
                        borderWidth: 1,
                        pointRadius: 0,
                        pointHoverRadius: 3
                    },
                    {
                        label: 'æ‰‹åŠ¨å¼‚å¸¸ç‚¹',
                        data: labels.map(i => [100, 200, 300].includes(i) ? currentTestData[i] : null),
                        borderColor: '#f44336',
                        backgroundColor: '#f44336',
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        showLine: false,
                        pointStyle: 'circle'
                    },
                    {
                        label: 'NETSæ£€æµ‹å¼‚å¸¸ç‚¹',
                        data: labels.map(() => null), // åˆå§‹åŒ–ä¸ºç©ºï¼Œç­‰å¾…æ£€æµ‹ç»“æœ
                        borderColor: '#ff9800',
                        backgroundColor: 'rgba(255, 152, 0, 0.8)', // å¢åŠ ä¸é€æ˜åº¦
                        pointRadius: 6, // å¢å¤§ç‚¹çš„å°ºå¯¸
                        pointHoverRadius: 10,
                        showLine: false,
                        pointStyle: 'triangle',
                        pointBorderWidth: 2, // å¢åŠ è¾¹æ¡†å®½åº¦
                        pointBorderColor: '#e65100' // æ·±è‰²è¾¹æ¡†å¢å¼ºå¯è§æ€§
                    }
                ]
            };

            // åˆ›å»ºå›¾è¡¨
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'æ•°æ®ç‚¹ç´¢å¼•'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'æ•°å€¼'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Java NETS å¼‚å¸¸æ£€æµ‹ç»“æœ - è¯·è°ƒæ•´å‚æ•°é‡æ–°æ£€æµ‹',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    if ([100, 200, 300].includes(index)) {
                                        return 'æ‰‹åŠ¨æ·»åŠ çš„å¼‚å¸¸ç‚¹ (+5)';
                                    }
                                    if (context.dataset.label === 'NETSæ£€æµ‹å¼‚å¸¸ç‚¹' && context.parsed.y !== null) {
                                        return 'NETSæ£€æµ‹åˆ°çš„å¼‚å¸¸ç‚¹';
                                    }
                                    return '';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', function() {
            initializeChart();

            // è¿è¡Œæ£€æµ‹æŒ‰é’®
            document.getElementById('runDetection').addEventListener('click', function() {
                const datasetSize = parseInt(document.getElementById('datasetSize').value);
                const r = parseFloat(document.getElementById('rValue').value);
                const k = parseInt(document.getElementById('kValue').value);
                const w = parseInt(document.getElementById('wValue').value);
                
                if (r < 0.01 || r > 1 || k < 1 || k > 50 || w < 100 || w > 3000) {
                    alert('å‚æ•°å€¼è¶…å‡ºæœ‰æ•ˆèŒƒå›´!');
                    return;
                }
                
                // é‡æ–°ç”Ÿæˆå¯¹åº”å¤§å°çš„æ•°æ®
                currentTestData = generateTestDataBySize(datasetSize);
                
                runNETSDetection(r, k, w);
            });

            // å¤§æ•°æ®é›†æµ‹è¯•æŒ‰é’®
            document.getElementById('testLargeDataset').addEventListener('click', testLargeDataset);

            // é‡ç½®å‚æ•°æŒ‰é’®
            document.getElementById('resetParams').addEventListener('click', function() {
                document.getElementById('rValue').value = 0.1;
                document.getElementById('kValue').value = 8;
                document.getElementById('wValue').value = 500;
                document.getElementById('presetParams').value = '';
            });

            // é¢„è®¾å‚æ•°é€‰æ‹©
            document.getElementById('presetParams').addEventListener('change', function() {
                const preset = this.value;
                if (preset) {
                    const [r, k, w] = preset.split(',').map(x => parseFloat(x));
                    document.getElementById('rValue').value = r;
                    document.getElementById('kValue').value = k;
                    document.getElementById('wValue').value = w;
                }
            });
        });
    </script>
</body>
</html>
