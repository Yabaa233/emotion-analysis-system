# PyOD异常检测工具使用说明

## 🎯 工具简介
使用5种机器学习算法（ECOD、隔离森林、PCA、MCD、GMM）检测异常点，并与您的手动标记进行对比。**现已优化算法调用并添加可视化功能！**

## 📊 报告格式
生成两种报告（参考batch_test_all_algorithms.py的图片格式）：
1. **每个算法的详细报告** - 包含可视化图表显示VA数据、检测异常点、手动标记点
2. **所有算法对比报告** - 包含性能对比图表、排行榜、执行时间对比

## 🚀 快速开始

### 1. 安装依赖
```bash
# 方式1：双击启动脚本（推荐）
双击 start_pyod_tool.bat

# 方式2：手动安装
python install_dependencies.py
```

### 2. 运行工具
```bash
python pyod_anomaly_detection_tool.py
```

### 3. 使用步骤
1. 点击"选择XDF文件"
2. 选择包含VA数据和ManualAnomalyMarks的XDF文件
3. 调整容差时间（默认±1秒）
4. 点击"运行异常检测"
5. 查看结果报告和自动生成的可视化图表

## 📈 核心功能

### 算法优化 ✨
- ✅ **智能参数设置** - 使用contamination=0.1确保能检测到异常
- ✅ **数据标准化** - 使用StandardScaler提升检测效果
- ✅ **正确的训练流程** - 参考batch_test_all_algorithms.py的最佳实践

### 可视化功能 🎨
- ✅ **单算法详细图表** - VA时间序列 + 异常点标记 + 异常分数
- ✅ **多算法对比图表** - 命中率、检测数量、执行时间、性能排名
- ✅ **自动保存图片** - 图表保存到临时目录并自动打开
- ✅ **智能标记显示** - 区分手动标记点和算法检测点

### 评估指标
- **命中率** - 算法检测异常点命中手动标记的比例（±1秒容差）  
- **执行时间** - 各算法运行时间对比
- **性能排名** - 按命中率和速度排序
- **可视化对比** - 直观的图表显示

### 报告输出
- **详细分析** - 每个算法的异常点详情和可视化图表
- **对比汇总** - 所有算法性能对比表格和图表
- **自动图表生成** - 类似batch_test_all_algorithms.py的专业图表
- **导出功能** - 保存完整报告和图片

## 🔧 文件说明

| 文件 | 说明 |
|------|------|
| `pyod_anomaly_detection_tool.py` | 主程序（已优化算法调用和可视化） |
| `install_dependencies.py` | 依赖安装脚本（含scikit-learn） |  
| `start_pyod_tool.bat` | Windows一键启动 |
| `test_pyod_tool.py` | 功能测试脚本 |

## 🎨 可视化示例

### 单算法报告图表
- **上图**: VA数据时间序列 + 手动标记点（绿色⭐） + 检测异常点（橙色●）
- **下图**: 异常分数时间序列 + 检测点标记

### 多算法对比图表
- **命中率对比**: 横向柱状图显示各算法命中率
- **检测数量对比**: 显示各算法检测到的异常点数
- **执行时间对比**: 显示各算法的运行速度
- **性能排名**: 文字总结最佳算法

## ❓ 常见问题

**Q: 现在能检测到异常点了吗？**  
A: 是的！已修复算法调用问题，使用contamination=0.1和数据标准化，确保能检测到异常。

**Q: 图表保存在哪里？**  
A: 自动保存到系统临时目录，工具会显示路径并尝试自动打开。

**Q: 如何提高检测效果？**  
A: 确保手动标记准确，可适当调整容差时间，数据质量越好效果越佳。

## 🎯 使用建议

1. **数据质量** - 确保XDF文件包含完整的VA数据和准确的手动标记
2. **标记数量** - 建议至少5-10个异常标记用于有效评估
3. **查看图表** - 重点关注生成的可视化图表，直观了解检测效果